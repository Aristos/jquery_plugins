(function(d){function g(c,b,a,e,j){a&&(a="string"==typeof a?[a]:a,d.each(a,function(a,h){var f=h.split(" "),g=f.shift(),f=d.trim(f.join(" "));b&&(f=f.replace(/(^|\s)element(\s|$)/g,function(a,d,c){return d+b.selector+c}));d("body").on(g,""===d.trim(f)?null:f,function(a){a.preventDefault();e(c,d(a.currentTarget),j)})}))}function k(c,b,a){var e;if("parent"==a.relativeTo)e=c.parent();else if("element"==a.relativeTo)if(b)e=b;else throw"relativeTo was set to element, but no element provided";else a.relativeTo&&
(e=d(a.relativeTo));return d.extend({},a,{relativeTo:e})}d.fn.okPopup=function(c){return d.okPopup.create(this,c)};d.okPopup={create:function(c,b){b=d.extend({content:"",template:"<div/>",parent:"body",location:{relativeTo:"parent"},onInit:function(){},onOpen:function(a,b){a.html(b.content)},onClose:null},b&&b.ui?d.okPopup.ui[b.ui].call(c,b):null,b);var a="function"==typeof b.template?b.template():b.template,e=d.okPopup.transitions[b.transition];if(!e)throw"No such transition '"+b.transition+"'";
a=(a instanceof jQuery?a:d(a)).appendTo(b.parent).addClass("ui-popup").hide();b.onInit.call(c,a,b);e.onInit&&e.onInit.call(c,a,b);g(a,c,b.openWhen,this.open,b);g(a,c,b.closeWhen,this.close,b);return a.extend({open:function(c){d.okPopup.open(a,c&&c.currentTarget?d(c.currentTarget):c,b);return a},close:function(c){d.okPopup.close(a,c&&c.currentTarget?d(c.currentTarget):c,b);return a}})},open:function(c,b,a){var e="function"==typeof a.content?a.content(c,b):a.content,j=d.Deferred(),g=function(){c.removeClass("loading");
j.resolve(d.positionAt(c,k(c,b,a.location)))},h=j.promise(),f;e instanceof jQuery||(e=d("<div />").html(e));c.addClass("loading");0<(f=e.find("img").andSelf().filter("img")).length&&d.fn.imagesLoaded?f.imagesLoaded(g):(f=e.find("iframe, object, embed").andSelf().filter("iframe, object, embed")).length?f.one("load",g).each(function(){this.complete&&d(this).trigger("load")}):g();e={element:b,content:e,options:a};h=a.onOpen(c,d.extend(e,h));if(!h||!h.done)h=j.promise();d.okPopup.transitions[a.transition].onOpen(c,
d.extend(e,h))},close:function(c,b,a){if(a.onClose)a.onClose(c,b);d.okPopup.transitions[a.transition].onClose(c,b)}}})(jQuery);
