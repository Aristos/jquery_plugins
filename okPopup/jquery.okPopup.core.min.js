(function(d){function g(c,b,a,e,j){a&&(a="string"==typeof a?[a]:a,d.each(a,function(a,h){var f=h.split(" "),g=f.shift(),f=d.trim(f.join(" "));b&&(f=f.replace(/(^|\s)element(\s|$)/g,function(a,c,d){return c+b.selector+d}));d("body").on(g,""===d.trim(f)?null:f,function(a){a.preventDefault();e(c,a,j)})}))}function k(c,b,a){switch(a.relativeTo){case "parent":a.offsetElement=c.parent();break;case "event":a.offsetElement=b;break;default:a.relativeTo&&(a.offsetElement=a.relativeTo)}return a}d.fn.okPopup=
function(c){d.okPopup.create(this,c)};d.okPopup={create:function(c,b){b=d.extend({content:"",ui:null,openWhen:null,closeWhen:null,template:"<div/>",parent:"body",transition:null,position:{location:"center",relativeTo:"parent",offset:null,margin:{top:0,left:0}},onInit:function(){},onOpen:function(a,b){a.html(b.content)},onClose:null},b.ui?d.okPopup.ui[b.ui].call(c,b):null,b);var a="function"==typeof b.template?b.template():b.template,e=d.okPopup.transitions[b.transition];if(!e)throw"No such transition '"+
b.transition+"'";a=(a instanceof jQuery?a:d(a)).appendTo(b.parent).addClass("ui-popup").hide();b.onInit.call(c,a,b);e.onInit&&e.onInit.call(c,a,b);g(a,c,b.openWhen,this.open,b);g(a,c,b.closeWhen,this.close,b);return a},open:function(c,b,a){var e="function"==typeof a.content?a.content(b,c):a.content,j=d.Deferred(),g=function(){c.removeClass("loading");j.resolve(d.positionAt(c,k(c,b,a.position)))},h=j.promise(),f;b.preventDefault();e instanceof jQuery||(e=d("<div />").html(e));c.addClass("loading");
0<(f=e.find("img").andSelf().filter("img")).length&&d.fn.imagesLoaded?f.imagesLoaded(g):(f=e.find("iframe object embed").andSelf().filter("iframe object embed")).length?f.one("load",g).each(function(){this.complete&&d(this).trigger("load")}):g();e={event:b,content:e,options:a};h=a.onOpen(c,d.extend(e,h));if(!h||!h.done)h=j.promise();d.okPopup.transitions[a.transition].onOpen(c,d.extend(e,h))},close:function(c,b,a){if(a.onClose)a.onClose(c,b);d.okPopup.transitions[a.transition].onClose(c,b)}}})(jQuery);
