
(function($){$.fn.nextUntil=function(expr){var match=[];this.each(function(){for(var i=this.nextSibling;i;i=i.nextSibling){if(i.nodeType!=1){continue;}
if($.filter(expr,[i]).length){break;}
match.push(i);}});return this.pushStack(match,arguments);};$.fn.okSlide=function(opts){var animating=false;opts=$.extend({duration:200,panelClass:'panel',vertical:false,nextTrigger:'a.more',prevClass:'prev',selectTrigger:"a:not('.more')",afterSelect:null,afterNext:null,afterPrev:null},opts);function animate(dir,$prevPanel){if(animating){return false;}
var $trigger=$(this),$panel=getNextPanel.call(this,dir,$prevPanel),$list=$prevPanel.closest("ul"),direction=dir=='next'?"-=":"+=",callback=dir=='next'?'afterNext':'afterPrev',params=opts.vertical?{marginTop:direction+$prevPanel.outerHeight()+"px"}:{marginLeft:direction+$prevPanel.outerWidth()+"px"};$prevPanel.nextUntil('#'+$panel.attr('id')).hide();$panel.show();animating=true;$list.animate(params,{queue:false,duration:opts.duration,complete:function(){animating=false;if(dir=='prev'){$($prevPanel.data('parentLink')).remove();}
if(opts[callback]){opts[callback].call($trigger[0],$panel);}}});}
function getNextPanel(dir,$currentPanel){var $panel;if(dir=='next'){$panel=$('#'+$currentPanel.attr('id')+"-"+$(this).attr('name'));}else{$panel=$('#'+$currentPanel.attr('id').replace(/\-(\w+)$/,''));}
return $panel;}
function appendPrevLinks($prevPanel){var $panel=getNextPanel.call(this,'next',$prevPanel),$list=$('> ul',$panel),$parentLink=$("<li><a href='#' class='"+opts.prevClass+"'>"+$(this).html()+"</a></li>");$list.prepend($parentLink);$panel.data('parentLink',$parentLink);$parentLink.click(function(e){e.preventDefault();animate.call(this,'prev',$panel);});return false;}
return this.each(function(){var $wrapper=$(this),$list=$('> ul',$wrapper),$panels=$('> li',$list),w=$panels.outerWidth(true),h=$panels.outerHeight(true);$wrapper.css("overflow","hidden");if(opts.vertical){$wrapper.height(h);}
$wrapper.width(w);$list.css('width',$panels.length*w).data('totalPanels',$panels.length);if(!opts.vertical){$panels.css('float','left');}
$panels.not(":first").hide();$(opts.nextTrigger,$list).click(function(e){e.preventDefault();if(animating){return false;}
var $panel=$(this).closest("."+opts.panelClass);appendPrevLinks.call(this,$panel);animate.call(this,'next',$panel);});$(opts.selectTrigger,$list).click(function(e){e.preventDefault();if(opts.afterSelect){opts.afterSelect.call(this,e);}});});};})(jQuery);