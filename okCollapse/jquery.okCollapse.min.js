
(function($){$.fn.okCollapse=function(opts){opts=$.extend({toggleSelector:"a",startCollapsed:true,collapsibleSelector:"ul",toggleEvent:"click",collapsedClass:"collapsed",collapseSpeed:3,expansionSpeed:5,fadeSpeed:3,maxDuration:200,collapseOthers:false,showSingle:true,afterShow:null,afterHide:null,callback:null},opts);var animating=false;function dispatch(e){e.preventDefault();var target=$(e.currentTarget),list=target.closest("li").find(opts.collapsibleSelector+":first");if(animating||list.length<1){if(opts.callback){opts.callback.call(list,target);}
return false;}else{animating=true;}
if(opts.collapseOthers){target.parent().siblings().find(opts.collapsibleSelector+":first").each(function(){if($(this).siblings("a:first").is(":visible")){hide($(this));}});}
if(opts.afterShow&&list.hasClass(opts.collapsedClass)){opts.afterShow.call(target);}
if(opts.afterHide&&!list.hasClass(opts.collapsedClass)){opts.afterHide.call(target);}
target.toggleClass(opts.collapsedClass);return list.hasClass(opts.collapsedClass)?show(list):hide(list);}
function show(list){if(!list.hasClass(opts.collapsedClass)){return(animating=false);}
list.css({display:'block'});if(!list.data("maxHeight")){list.data("maxHeight",list.height()).css({height:0,opacity:0});}
return animate(list,list.data('maxHeight'),1,opts.expansionSpeed,function(){this.css("height","auto");});}
function hide(list){if(list.hasClass(opts.collapsedClass)){return(animating=false);}
list.css({opacity:0});return animate(list,0,0,opts.collapseSpeed);}
function animate(list,finalHeight,finalOpacity,movementSpeed,callback){var movementDuration=movementSpeed*list.data("maxHeight"),fadeDuration=opts.fadeSpeed*list.data("maxHeight");return list.stop(true,true).animate({height:finalHeight},(movementDuration>opts.maxDuration?opts.maxDuration:movementDuration),function(){if(callback){callback.call($(this));}
list.animate({opacity:finalOpacity},(fadeDuration>opts.maxDuration?opts.maxDuration:fadeDuration));animating=false;}).toggleClass(opts.collapsedClass);}
return this.each(function(){var self;$(this).delegate(opts.toggleSelector,opts.toggleEvent,dispatch).find(opts.collapsibleSelector).each(function(){self=$(this);if(!opts.showSingle&&self.children().length<=1){self.siblings(opts.toggleSelector+":first").hide();}else{self.data("maxHeight",self.height());if(opts.startCollapsed||self.hasClass(opts.collapsedClass)){self.css({height:0,opacity:0}).addClass(opts.collapsedClass);}}});});};})(jQuery);