
(function($){$.fn.okCollapse=function(opts){opts=$.extend({toggleSelector:"a",toggleEvent:"click",collapsedClass:"collapsed",collapseSpeed:3,expansionSpeed:5,fadeSpeed:3,maxDuration:200,collapseOthers:false,callback:null},opts);var animating=false;function dispatch(e){e.preventDefault();var target=$(e.currentTarget),list=target.closest("li").find("> ul:first");if(animating||list.length<1){if(opts.callback){opts.callback.call(list,target);}
return false;}else{animating=true;}
if(opts.collapseOthers){target.parent().siblings().find("ul:first").each(function(){if($(this).siblings("a:first").is(":visible")){hide($(this));}});}
return list.hasClass(opts.collapsedClass)?show(list):hide(list);}
function show(list){if(!list.hasClass(opts.collapsedClass)){return(animating=false);}
list.css({display:'block'});if(!list.data("maxHeight")){list.data("maxHeight",list.height()).css({height:0,opacity:0});}
return animate(list,list.data('maxHeight'),1,opts.expansionSpeed);}
function hide(list){if(list.hasClass(opts.collapsedClass)){return(animating=false);}
list.css({opacity:0});return animate(list,0,0,opts.collapseSpeed);}
function animate(list,finalHeight,finalOpacity,movementSpeed){var movementDuration=movementSpeed*list.data("maxHeight"),fadeDuration=opts.fadeSpeed*list.data("maxHeight");return list.animate({height:finalHeight},(movementDuration>opts.maxDuration?opts.maxDuration:movementDuration),function(){list.animate({opacity:finalOpacity},(fadeDuration>opts.maxDuration?opts.maxDuration:fadeDuration));animating=false;}).toggleClass(opts.collapsedClass);}
return this.each(function(){var self;$(this).delegate(opts.toggleSelector,opts.toggleEvent,dispatch).find("ul").each(function(){self=$(this);if(self.children().length<=1){self.siblings(opts.toggleSelector+":first").hide();}else{self.data("maxHeight",self.height()).css({height:0,opacity:0}).addClass(opts.collapsedClass);}});});};})(jQuery);